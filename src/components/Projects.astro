---
import { getCollection } from "astro:content";
import ProjectTile from "./ProjectTile.astro";
import "@splidejs/splide/css";
import { Splide, SplideSlide } from "astro-splide";

const allProjects = await getCollection("projects");
// Sort by order field (lower numbers first), then by date if no order specified
const sortedProjects = allProjects.sort((a, b) => {
  const orderA = a.data.order ?? Infinity;
  const orderB = b.data.order ?? Infinity;
  if (orderA !== orderB) {
    return orderA - orderB;
  }
  // If order is the same or both undefined, sort by date (most recent first)
  const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
  const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
  return dateB - dateA;
});
---

<section class="my-12 lg:my-24 overflow-hidden">
  <div class="max-w-7xl mx-auto">
    <h2 class="text-4xl font-bold mb-16 px-4 lg:px-8">Projects</h2>
    <Splide
      options={{
        type: "slide",
        gap: "1rem",
        perPage: 1,
        pagination: false,
        snap: false,
        drag: "free",
        arrows: false,

        padding: {
          left: "14px",
          right: "4rem",
        },
        mediaQuery: "min",
        breakpoints: {
          500: {
            perPage: 1,
            gap: "2rem",
          },
          768: {
            perPage: 2,
            arrows: true,
          },
          1024: {
            perPage: 3,
            padding: {
              left: "2rem",
              right: "2rem",
            },
          },
        },
      }}
    >
      {
        sortedProjects.map((item: object, index: number) => (
          <SplideSlide>
            <ProjectTile item={item} />
          </SplideSlide>
        ))
      }
    </Splide>
  </div>
</section>
